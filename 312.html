<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>滚筒式工作区切换</title>
    <style>
        body {
            margin: 0;
            font-family: system-ui, sans-serif;
            background: #f5f7fa;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        button.open-btn {
            padding: 10px 20px;
            font-size: 16px;
            background: #409eff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .overlay.active {
            display: flex;
        }

        .scene {
            width: 600px;
            height: 260px;
            perspective: 1200px;
        }

        .cylinder {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            position: relative;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            cursor: pointer;
            user-select: none;
        }

        .card h3 {
            font-size: 20px;
            margin: 0;
        }

        .card p {
            font-size: 14px;
            color: #555;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 22px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }

        .dots {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ccc;
            margin: 0 6px;
            transition: background 0.3s;
        }

        .dot.active {
            background: #409eff;
        }
    </style>
</head>
<body>

<button class="open-btn" id="openBtn">切换工作区</button>

<div class="overlay" id="overlay">
    <button class="close-btn" id="closeBtn">×</button>
    <div class="scene">
        <div class="cylinder" id="cylinder">
            <!-- 卡片会被 JS 动态注入 -->
        </div>
    </div>
    <div class="dots" id="dots"></div>
</div>

<script>
    const total = 3  // 可自由改成 6、7...
    const step = 360 / total
    const cylinder = document.getElementById('cylinder')
    const overlay = document.getElementById('overlay')
    const dots = document.getElementById('dots')

    let angle = 0
    let targetAngle = 0
    let isAnimating = false
    let scrollTimer = null

    const workspaces = [
        { name: '工作区 A', desc: '📂 项目 / 文件' },
        { name: '工作区 B', desc: '📁 Markdown 文档' },
        { name: '工作区 C', desc: '📝 草稿 / 临时记录' },
        { name: '工作区 D', desc: '🗂️ 日志 / 归档' },
        { name: '工作区 E', desc: '📋 TODO / 日程' },
    ]

    function initCards() {
        cylinder.innerHTML = ''
        dots.innerHTML = ''
        for (let i = 0; i < total; i++) {
            const card = document.createElement('div')
            card.className = 'card'
            card.style.transform = `rotateY(${i * step}deg) translateZ(300px)`
            card.innerHTML = `<h3>${workspaces[i].name}</h3><p>${workspaces[i].desc}</p>`
            card.onclick = () => selectWorkspace(i)
            cylinder.appendChild(card)

            const dot = document.createElement('div')
            dot.className = 'dot'
            dots.appendChild(dot)
        }
    }

    function updateDots() {
        const dotsList = dots.querySelectorAll('.dot')
        const normalized = ((Math.round(angle / step) % total) + total) % total
        dotsList.forEach((d, i) => {
            d.classList.toggle('active', i === normalized)
        })
    }

    function animate() {
        if (!isAnimating) return

        angle += (targetAngle - angle) * 0.08
        if (Math.abs(targetAngle - angle) < 0.5) {
            angle = targetAngle
            isAnimating = false
        }

        cylinder.style.transform = `rotateY(${angle}deg)`
        updateDots()
        requestAnimationFrame(animate)
    }

    function scrollToNearestCard() {
        const rawIndex = Math.round(angle / step)
        const snappedAngle = rawIndex * step
        targetAngle = snappedAngle
        isAnimating = true
        requestAnimationFrame(animate)
    }

    document.getElementById('openBtn').onclick = () => {
        overlay.classList.add('active')
        initCards()
        angle = 0
        targetAngle = 0
        updateDots()
        cylinder.style.transform = `rotateY(0deg)`
    }

    document.getElementById('closeBtn').onclick = () => {
        overlay.classList.remove('active')
    }

    function selectWorkspace(index) {
        alert(`✅ 切换到 ${workspaces[index].name}`)
        overlay.classList.remove('active')
    }

    overlay.addEventListener('wheel', (e) => {
        e.preventDefault()
        targetAngle += e.deltaY * 0.3
        isAnimating = true
        requestAnimationFrame(animate)
        clearTimeout(scrollTimer)
        scrollTimer = setTimeout(scrollToNearestCard, 300)
    }, { passive: false })
</script>
</body>
</html>
