<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocsFlow - 智能文档管理</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Basic animation for pulse-once */
        @keyframes pulse-once {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse-once {
            animation: pulse-once 1s ease-in-out 1;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* gray-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* gray-400 */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-800 flex">

<!-- Sidebar -->
<aside class="w-64 bg-white text-gray-800 flex flex-col p-6 shadow-xl rounded-r-3xl border-r border-gray-200 flex-shrink-0">
    <div class="flex items-center mb-12 mt-4">
            <span class="text-4xl text-indigo-600 mr-3 animate-pulse">
                <!-- Custom SVG for a modern, abstract document/data icon -->
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                </svg>
            </span>
        <h1 class="text-3xl font-extrabold text-gray-900 tracking-wider">DocsFlow</h1>
    </div>

    <!-- Navigation Links -->
    <nav class="flex-1 space-y-3">
        <a href="#" class="flex items-center space-x-3 p-3 rounded-xl bg-indigo-100 text-indigo-700 transition duration-300 group hover:scale-105 transform">
            <!-- Lucide icon for dashboard -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid-2 group-hover:rotate-6 transition-transform">
                <rect x="3" y="3" width="7" height="7" rx="1" />
                <rect x="14" y="3" width="7" height="7" rx="1" />
                <rect x="14" y="14" width="7" height="7" rx="1" />
                <rect x="3" y="14" width="7" height="7" rx="1" />
            </svg>
            <span class="text-lg font-medium">仪表盘</span>
        </a>
        <a href="#" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-300 text-gray-700 hover:text-indigo-700 group hover:scale-105 transform">
            <!-- Lucide icon for files -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder group-hover:rotate-6 transition-transform">
                <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2h16Z" />
            </svg>
            <span class="text-lg font-medium">所有文件</span>
        </a>
        <a href="#" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-300 text-gray-700 hover:text-indigo-700 group hover:scale-105 transform">
            <!-- Lucide icon for users -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-round group-hover:rotate-6 transition-transform">
                <path d="M18 21a8 8 0 0 0-16 0" />
                <circle cx="10" cy="8" r="5" />
                <path d="M22 20c0-3.37-2.7-3.87-4-4s-7 1-7 4" />
                <path d="M17 14c.7-.7 1.4-1.2 2-1.2s1.3.5 2 1.2" />
            </svg>
            <span class="text-lg font-medium">团队协作</span>
        </a>
        <a href="#" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-300 text-gray-700 hover:text-indigo-700 group hover:scale-105 transform">
            <!-- Lucide icon for robot -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot group-hover:rotate-6 transition-transform">
                <path d="M12 8V4H8" />
                <rect width="16" height="16" x="4" y="8" rx="2" />
                <path d="M2 14h2" />
                <path d="M20 14h2" />
                <path d="M7 14v2" />
                <path d="M17 14v2" />
                <path d="M10 14v2" />
                <path d="M14 14v2" />
                <path d="M12 18h.01" />
            </svg>
            <span class="text-lg font-medium">AI 助手</span>
        </a>
        <a href="#" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-300 text-gray-700 hover:text-indigo-700 group hover:scale-105 transform">
            <!-- Lucide icon for settings -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings group-hover:rotate-6 transition-transform">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l-.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                <circle cx="12" cy="12" r="3" />
            </svg>
            <span class="text-lg font-medium">系统设置</span>
        </a>
    </nav>

    <!-- User Profile / Logout at bottom of sidebar -->
    <div class="mt-auto pt-6 border-t border-gray-200">
        <div class="flex items-center space-x-3 p-3 rounded-xl mb-3">
            <img class="w-10 h-10 rounded-full border-2 border-indigo-500" src="https://placehold.co/40x40/6366f1/FFFFFF?text=U" alt="User Avatar" />
            <div>
                <p class="font-semibold text-gray-900">用户名称</p>
                <p class="text-sm text-gray-600">管理员</p>
            </div>
        </div>
        <button class="flex items-center space-x-3 p-3 rounded-xl bg-red-500 text-white w-full justify-center hover:bg-red-600 transition duration-300 shadow-lg">
            <!-- Lucide icon for log out -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="17 16 22 12 17 8" />
                <line x1="22" x2="10" y1="12" y2="12" />
            </svg>
            <span class="text-lg font-medium">退出登录</span>
        </button>
    </div>
</aside>

<!-- Main Content Area -->
<main class="flex-1 p-8 md:p-12 overflow-y-auto">
    <!-- Top Section: Welcome, Search, Quick Actions -->
    <section class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 space-y-4 md:space-y-0">
        <h2 class="text-4xl font-extrabold text-gray-900 leading-tight">
            您好，<span class="text-indigo-600">[用户名称]</span>！<br class="md:hidden" />
            您的智能工作流一览无余。
        </h2>
        <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 w-full md:w-auto">
            <!-- Global Search Bar -->
            <div class="relative w-full sm:w-80">
                <input
                        type="text"
                        placeholder="搜索文件、任务或洞察..."
                        class="w-full pl-12 pr-4 py-3 rounded-full border border-gray-300 bg-white text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm"
                />
                <svg class="w-6 h-6 text-gray-500 absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <!-- Quick Create Button -->
            <button class="bg-indigo-600 text-white px-6 py-3 rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 flex items-center space-x-2 w-full sm:w-auto justify-center animate-pulse-once">
                <!-- Lucide icon for plus -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
                    <line x1="12" x2="12" y1="5" y2="19" />
                    <line x1="5" x2="19" y1="12" y2="12" />
                </svg>
                <span>创建</span>
            </button>
        </div>
    </section>

    <!-- Main Dashboard Cards - More flexible grid -->
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 mb-10">
        <!-- Featured AI Smart Summary Card - Spans 2 columns on larger screens -->
        <div class="lg:col-span-2 bg-gradient-to-br from-indigo-600 to-purple-700 p-8 rounded-3xl shadow-xl text-white relative overflow-hidden group hover:scale-[1.01] transition-transform duration-300">
            <div class="absolute top-0 right-0 w-24 h-24 bg-indigo-500 rounded-full opacity-10 transform translate-x-1/2 -translate-y-1/2"></div>
            <div class="absolute bottom-0 left-0 w-32 h-32 bg-purple-500 rounded-full opacity-10 transform -translate-x-1/2 translate-y-1/2"></div>
            <div class="flex items-center space-x-4 mb-4">
                    <span class="text-purple-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles">
                            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                        </svg>
                    </span>
                <h3 class="text-3xl font-bold">AI 智能概览</h3>
            </div>
            <p class="text-indigo-200 text-lg mb-6 leading-relaxed">
                “季度战略回顾.pptx”：AI 已为您提炼出 5 个关键洞察和 3 项待办事项。
            </p>
            <button class="bg-white text-indigo-800 px-6 py-3 rounded-full font-semibold shadow-md hover:bg-gray-200 transition duration-300 flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye">
                    <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                    <circle cx="12" cy="12" r="3" />
                </svg>
                <span>查看详情</span>
            </button>
        </div>

        <!-- New Dashboard Card: Total Documents -->
        <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col justify-between hover:scale-[1.01] transition-transform duration-300">
            <div class="flex items-center space-x-3 mb-4">
                    <span class="text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-files">
                            <path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z" />
                            <path d="M8 2v4a2 2 0 0 0 2 2h4" />
                            <path d="M18.5 10H19a2 2 0 0 0 2-2V7.5L17.5 3" />
                            <path d="M12 22h-.5a2 2 0 0 1-2-2v-1.5" />
                        </svg>
                    </span>
                <h3 class="text-xl font-semibold text-gray-900">总文档数</h3>
            </div>
            <p class="text-4xl font-bold text-blue-700 mb-2">1,234</p>
            <p class="text-gray-600 text-sm">所有文件和版本</p>
            <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                查看所有 →
            </button>
        </div>

        <!-- New Dashboard Card: Pending Approvals -->
        <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col justify-between hover:scale-[1.01] transition-transform duration-300">
            <div class="flex items-center space-x-3 mb-4">
                    <span class="text-orange-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-check">
                            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15.5 2z" />
                            <polyline points="14 2 14 8 20 8" />
                            <path d="m9 16 2 2 4-4" />
                        </svg>
                    </span>
                <h3 class="text-xl font-semibold text-gray-900">待审批</h3>
            </div>
            <p class="text-4xl font-bold text-orange-700 mb-2">5</p>
            <p class="text-gray-600 text-sm">待您处理的合同/文件</p>
            <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                立即审批 →
            </button>
        </div>

        <!-- New Dashboard Card: Storage Used -->
        <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col justify-between hover:scale-[1.01] transition-transform duration-300">
            <div class="flex items-center space-x-3 mb-4">
                    <span class="text-purple-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database">
                            <ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M3 5V19A9 3 0 0 0 21 19V5" /><path d="M3 12V19A9 3 0 0 0 21 19V12" />
                        </svg>
                    </span>
                <h3 class="text-xl font-semibold text-gray-900">存储使用</h3>
            </div>
            <p class="text-4xl font-bold text-purple-700 mb-2">60 GB</p>
            <p class="text-gray-600 text-sm">总共 100 GB</p>
            <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                管理存储 →
            </button>
        </div>

        <!-- New Dashboard Card: Recent Activity Summary -->
        <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col justify-between hover:scale-[1.01] transition-transform duration-300">
            <div class="flex items-center space-x-3 mb-4">
                    <span class="text-green-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                        </svg>
                    </span>
                <h3 class="text-xl font-semibold text-gray-900">最近活动</h3>
            </div>
            <p class="text-4xl font-bold text-green-700 mb-2">12</p>
            <p class="text-gray-600 text-sm">过去 24 小时内的更新</p>
            <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                查看时间线 →
            </button>
        </div>
    </section>

    <!-- Dynamic Information Stream - Responsive Layout (Kept as is, as it's already list-like cards) -->
    <section class="mb-10">
        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center space-x-3">
                <span class="text-green-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-stream">
                        <path d="M2.2 10H8l4 8 4-8h6" />
                        <path d="M2.2 14H8l4-8 4 8h6" />
                    </svg>
                </span>
            <span>智能信息流</span>
            <button class="ml-auto text-sm text-gray-500 hover:text-indigo-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                </svg>
            </button>
        </h3>
        <div class="bg-white p-6 rounded-3xl shadow-xl border border-green-100 space-y-6">
            <!-- Stream Item 1: New Document Upload -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 border-b border-gray-100 pb-4 last:border-b-0 last:pb-0">
                <div class="bg-green-100 text-green-600 p-3 rounded-full flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" x2="12" y1="3" y2="15" />
                    </svg>
                </div>
                <div class="flex-grow">
                    <p class="font-semibold text-gray-900">
                        <span class="text-indigo-600">您</span> 上传了 <span class="text-blue-700">“最新销售数据报告.xlsx”</span>
                    </p>
                    <p class="text-sm text-gray-600 mt-1">
                        AI 自动分类为“财务报告”并提取了关键指标。
                    </p>
                    <span class="text-xs text-gray-500 mt-2 block sm:hidden">刚刚</span> <!-- Hidden on larger screens -->
                </div>
                <button class="bg-gray-100 text-gray-600 px-4 py-2 rounded-full text-sm hover:bg-gray-200 transition duration-300 flex-shrink-0 w-full sm:w-auto">
                    打开
                </button>
                <span class="text-xs text-gray-500 hidden sm:block flex-shrink-0">刚刚</span> <!-- Shown on larger screens -->
            </div>

            <!-- Stream Item 2: Team Collaboration -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 border-b border-gray-100 pb-4 last:border-b-0 last:pb-0">
                <div class="bg-yellow-100 text-yellow-600 p-3 rounded-full flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-code">
                        <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />
                        <path d="m10 10-2 2 2 2" />
                        <path d="m14 10 2 2-2 2" />
                    </svg>
                </div>
                <div class="flex-grow">
                    <p class="font-semibold text-gray-900">
                        <span class="text-indigo-600">张三</span> 在 <span class="text-blue-700">“产品设计草图.pptx”</span> 中添加了 <span class="font-semibold text-orange-500">3 条评论</span>。
                    </p>
                    <p class="text-sm text-gray-600 mt-1">
                        讨论了用户界面优化建议。
                    </p>
                    <span class="text-xs text-gray-500 mt-2 block sm:hidden">30分钟前</span>
                </div>
                <button class="bg-gray-100 text-gray-600 px-4 py-2 rounded-full text-sm hover:bg-gray-200 transition duration-300 flex-shrink-0 w-full sm:w-auto">
                    查看评论
                </button>
                <span class="text-xs text-gray-500 hidden sm:block flex-shrink-0">30分钟前</span>
            </div>

            <!-- Stream Item 3: AI Action -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                <div class="bg-blue-100 text-blue-600 p-3 rounded-full flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                    </svg>
                </div>
                <div class="flex-grow">
                    <p class="font-semibold text-gray-900">
                        <span class="text-indigo-600">AI 助手</span> 自动归档了 <span class="text-blue-700">“2023年旧项目文档”</span>。
                    </p>
                    <p class="text-sm text-gray-600 mt-1">
                        释放了 1.5 GB 存储空间。
                    </p>
                    <span class="text-xs text-gray-500 mt-2 block sm:hidden">1小时前</span>
                </div>
                <button class="bg-gray-100 text-gray-600 px-4 py-2 rounded-full text-sm hover:bg-gray-200 transition duration-300 flex-shrink-0 w-full sm:w-auto">
                    详情
                </button>
                <span class="text-xs text-gray-500 hidden sm:block flex-shrink-0">1小时前</span>
            </div>
        </div>
    </section>

    <!-- New Section: Personalized Widgets / My Widgets -->
    <section class="mb-10">
        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center space-x-3">
                <span class="text-purple-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <line x1="3" y1="9" x2="21" y2="9" />
                        <line x1="3" y1="15" x2="21" y2="15" />
                        <line x1="9" y1="3" x2="9" y2="21" />
                        <line x1="15" y1="3" x2="15" y2="21" />
                    </svg>
                </span>
            <span>我的小组件</span>
            <button id="addWidgetBtn" class="ml-auto bg-indigo-500 text-white px-4 py-2 rounded-full text-sm hover:bg-indigo-600 transition duration-300 flex items-center space-x-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
                    <line x1="12" x2="12" y1="5" y2="19" />
                    <line x1="5" x2="19" y1="12" y2="12" />
                </svg>
                <span>添加小组件</span>
            </button>
        </h3>
        <!-- Responsive Grid for Widgets -->
        <div id="widgetsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Widgets will be rendered here by JavaScript -->
        </div>
    </section>

    <!-- Add Widget Modal -->
    <div id="addWidgetModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">添加小组件</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x">
                        <path d="M18 6 6 18" /><path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>
            <div id="widgetTypeSelection" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-96 overflow-y-auto pr-2">
                <!-- Widget type buttons will be rendered here by JavaScript -->
            </div>

            <div id="customHtmlInputSection" class="mt-6 p-4 border border-gray-300 rounded-lg bg-gray-50 hidden">
                <label for="customHtmlFile" class="block text-sm font-medium text-gray-700 mb-2">选择 HTML 文件:</label>
                <input
                        type="file"
                        id="customHtmlFile"
                        accept=".html,.htm"
                        class="w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                />
                <p id="customHtmlFileNameDisplay" class="text-sm text-gray-600 mt-2 hidden">已选择文件: <span class="font-semibold"></span></p>
                <p id="customHtmlFilePrompt" class="text-sm text-gray-500 mt-2">请选择一个 HTML 文件来启用“添加”按钮。</p>
                <p class="text-xs text-red-500 mt-2">
                    <span class="font-bold">安全警告：</span>直接渲染用户上传的 HTML 文件存在跨站脚本 (XSS) 攻击风险。在生产环境中，强烈建议对内容进行严格净化或在沙盒化的 iframe 中加载。
                </p>
            </div>

            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelAddWidgetBtn" class="bg-gray-200 text-gray-800 px-6 py-3 rounded-full hover:bg-gray-300 transition duration-300">
                    取消
                </button>
                <button id="confirmAddWidgetBtn" class="px-6 py-3 rounded-full font-semibold shadow-md transition duration-300 bg-indigo-300 text-white cursor-not-allowed">
                    添加
                </button>
            </div>
        </div>
    </div>
</main>

<script>
    // Global state variables
    let activeWidgets = [
        { id: 'deadlines', type: '即将截止' },
        { id: 'notes', type: '快速笔记' },
        { id: 'recent-searches', type: '最近搜索' },
        { id: 'storage', type: '存储使用' },
        { id: 'pinned', type: '置顶文件' },
        { id: 'quick-actions', type: '快捷操作' },
    ];
    let showAddWidgetModal = false;
    let selectedWidgetTypeForAdd = null;
    let customHtmlFileContent = '';
    let customHtmlFileName = '';
    let aiInputText = '';
    let aiResponse = '';
    let aiLoading = false;

    // DOM Elements
    const widgetsContainer = document.getElementById('widgetsContainer');
    const addWidgetBtn = document.getElementById('addWidgetBtn');
    const addWidgetModal = document.getElementById('addWidgetModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelAddWidgetBtn = document.getElementById('cancelAddWidgetBtn');
    const confirmAddWidgetBtn = document.getElementById('confirmAddWidgetBtn');
    const widgetTypeSelection = document.getElementById('widgetTypeSelection');
    const customHtmlInputSection = document.getElementById('customHtmlInputSection');
    const customHtmlFile = document.getElementById('customHtmlFile');
    const customHtmlFileNameDisplay = document.getElementById('customHtmlFileNameDisplay');
    const customHtmlFileNameSpan = customHtmlFileNameDisplay.querySelector('span');
    const customHtmlFilePrompt = document.getElementById('customHtmlFilePrompt');

    // Define all available widget types with their icons and colors
    const availableWidgetTypes = [
        { id: 'deadlines', name: '即将截止', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-x"><path d="M8 2v4" /><path d="M16 2v4" /><rect width="18" height="18" x="3" y="4" rx="2" /><path d="M3 10h18" /><path d="m14.5 17.5-5-5" /><path d="m9.5 17.5 5-5" /></svg>`, color: 'text-red-500' },
        { id: 'notes', name: '快速笔记', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-pen"><path d="M12 11V5" /><path d="M18 12V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4" /><path d="M16 22h2a2 2 0 0 0 2-2v-2" /><path d="M16 12l-2 2 4 4 2-2z" /></svg>`, color: 'text-yellow-500' },
        { id: 'recent-searches', name: '最近搜索', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>`, color: 'text-blue-500' },
        { id: 'storage', name: '存储使用', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database"><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M3 5V19A9 3 0 0 0 21 19V5" /><path d="M3 12V19A9 3 0 0 0 21 19V12" /></svg>`, color: 'text-indigo-600' },
        { id: 'pinned', name: '置顶文件', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pin"><line x1="12" x2="12" y1="17" y2="22" /><path d="M15 14.4V10a3 3 0 0 0-1-2.2V5a2 2 0 0 0-4 0v2.8a3 3 0 0 0-1 2.2v4.4L3 18v2h18v-2z" /></svg>`, color: 'text-green-600' },
        { id: 'quick-actions', name: '快捷操作', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bolt"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><line x1="12" x2="12" y1="18" y2="22" /><line x1="12" x2="12" y1="2" y2="6" /><line x1="10" x2="14" y1="3" y2="3" /><line x1="10" x2="14" y1="21" y2="21" /></svg>`, color: 'text-blue-600' },
        { id: 'calendar', name: '日历', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></svg>`, color: 'text-orange-500' },
        { id: 'team-activity', name: '团队活动', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity"><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></svg>`, color: 'text-teal-500' },
        { id: 'document-stats', name: '文档统计', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-bar-chart"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M8 18v-4" /><path d="M12 18v-2" /><path d="M16 18v-6" /></svg>`, color: 'text-purple-500' },
        { id: 'recent-files', name: '最近文件', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></svg>`, color: 'text-gray-700' },
        { id: 'custom-html-app', name: '自定义 HTML 应用', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code"><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></svg>`, color: 'text-pink-500' },
        { id: 'ai-doc-assistant', name: 'AI 文档助手', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot"><path d="M12 8V4H8" /><rect width="16" height="16" x="4" y="8" rx="2" /><path d="M2 14h2" /><path d="M20 14h2" /><path d="M7 14v2" /><path d="M17 14v2" /><path d="M10 14v2" /><path d="M14 14v2" /><path d="M12 18h.01" /></svg>`, color: 'text-purple-600' }
    ];

    // Function to render all active widgets
    function renderActiveWidgets() {
        widgetsContainer.innerHTML = ''; // Clear existing widgets
        activeWidgets.forEach(widget => {
            const widgetHtml = renderWidgetHtml(widget);
            if (widgetHtml) {
                widgetsContainer.insertAdjacentHTML('beforeend', widgetHtml);
            }
        });

        // Re-attach event listeners for dynamically added elements (like remove buttons, AI buttons)
        document.querySelectorAll('.remove-widget-btn').forEach(button => {
            button.onclick = (event) => {
                const widgetIdToRemove = event.currentTarget.dataset.widgetId;
                removeWidget(widgetIdToRemove);
            };
        });

        // Re-attach event listeners for AI assistant buttons
        if (document.getElementById('aiSummarizeBtn')) {
            document.getElementById('aiSummarizeBtn').onclick = summarizeDocument;
        }
        if (document.getElementById('aiExtractActionItemsBtn')) {
            document.getElementById('aiExtractActionItemsBtn').onclick = extractActionItems;
        }
        if (document.getElementById('aiInputTextarea')) {
            document.getElementById('aiInputTextarea').oninput = (event) => {
                aiInputText = event.target.value;
                updateAiWidgetButtons(); // Update button state when input changes
            };
        }
    }

    // Helper function to render a specific widget's HTML string
    function renderWidgetHtml(widget) {
        const widgetConfig = availableWidgetTypes.find(config => config.id === widget.id.split('-')[0]);
        if (!widgetConfig) return '';

        const removeButtonHtml = `
                <button data-widget-id="${widget.id}" class="remove-widget-btn absolute top-3 right-3 text-gray-400 hover:text-gray-600 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x">
                        <path d="M18 6 6 18" /><path d="m6 6 12 12" />
                    </svg>
                </button>
            `;

        const cardHeaderHtml = `
                <div class="flex items-center space-x-3 mb-4">
                    <span class="${widgetConfig.color}">
                        ${widgetConfig.icon}
                    </span>
                    <h4 class="text-xl font-semibold text-gray-900">${widget.title || widgetConfig.name}</h4>
                </div>
            `;

        let contentHtml = '';
        let cardClasses = "bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col relative";

        switch (widget.type) {
            case '即将截止':
                contentHtml = `
                        <ul class="text-sm text-gray-700 space-y-2 flex-grow">
                            <li class="flex justify-between items-center">
                                <span>项目报告 V2</span>
                                <span class="text-red-500">今天</span>
                            </li>
                            <li class="flex justify-between items-center">
                                <span>合同续签</span>
                                <span class="text-orange-500">明天</span>
                            </li>
                            <li class="flex justify-between items-center">
                                <span>团队会议议程</span>
                                <span class="text-gray-500">周五</span>
                            </li>
                        </ul>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            查看所有 →
                        </button>
                    `;
                break;
            case '快速笔记':
                contentHtml = `
                        <textarea
                            class="w-full h-24 p-2 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 flex-grow"
                            placeholder="在这里快速记录您的想法..."
                        ></textarea>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            保存笔记 →
                        </button>
                    `;
                break;
            case '最近搜索':
                contentHtml = `
                        <ul class="text-sm text-gray-700 space-y-2 flex-grow">
                            <li class="hover:text-indigo-600 cursor-pointer">“2024 市场趋势”</li>
                            <li class="hover:text-indigo-600 cursor-pointer">“客户反馈报告”</li>
                            <li class="hover:text-indigo-600 cursor-pointer">“项目A 预算”</li>
                        </ul>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            查看所有 →
                        </button>
                    `;
                break;
            case '存储使用':
                contentHtml = `
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                            <div class="bg-indigo-500 h-3 rounded-full" style="width: 60%;"></div>
                        </div>
                        <p class="text-sm text-gray-600"><span class="font-semibold">60 GB</span> / 100 GB 已用</p>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            管理存储 →
                        </button>
                    `;
                break;
            case '置顶文件':
                contentHtml = `
                        <ul class="text-sm text-gray-700 space-y-2 flex-grow">
                            <li class="hover:text-indigo-600 cursor-pointer">项目计划书 V3.pdf</li>
                            <li class="hover:text-indigo-600 cursor-pointer">团队会议纪要 2024</li>
                            <li class="hover:text-indigo-600 cursor-pointer">重要合同模板.docx</li>
                        </ul>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            管理置顶 →
                        </button>
                    `;
                break;
            case '快捷操作':
                contentHtml = `
                        <div class="grid grid-cols-2 gap-3 text-sm flex-grow">
                            <button class="bg-gray-50 py-2 px-3 rounded-lg hover:bg-gray-100 transition duration-300">
                                上传文件
                            </button>
                            <button class="bg-gray-50 py-2 px-3 rounded-lg hover:bg-gray-100 transition duration-300">
                                创建文件夹
                            </button>
                            <button class="bg-gray-50 py-2 px-3 rounded-lg hover:bg-gray-100 transition duration-300">
                                邀请成员
                            </button>
                            <button class="bg-gray-50 py-2 px-3 rounded-lg hover:bg-gray-100 transition duration-300">
                                清理空间
                            </button>
                        </div>
                    `;
                break;
            case '日历':
                contentHtml = `
                        <div class="text-sm text-gray-700 flex-grow">
                            <p class="mb-2">今天是：<span class="font-semibold">${new Date().toLocaleDateString('zh-CN')}</span></p>
                            <p class="font-semibold">今日事件：</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>上午 10:00 - 项目 A 冲刺会议</li>
                                <li>下午 02:00 - 客户 B 电话会议</li>
                            </ul>
                        </div>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            查看完整日历 →
                        </button>
                    `;
                break;
            case '团队活动':
                contentHtml = `
                        <ul class="text-sm text-gray-700 space-y-2 flex-grow">
                            <li><span class="font-semibold">李明</span> 更新了“市场计划书”</li>
                            <li><span class="font-semibold">王芳</span> 评论了“设计稿 V2”</li>
                            <li><span class="font-semibold">您</span> 共享了“季度报告”</li>
                        </ul>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            查看所有活动 →
                        </button>
                    `;
                break;
            case '文档统计':
                contentHtml = `
                        <div class="text-sm text-gray-700 flex-grow">
                            <p class="mb-2">总文档数：<span class="font-semibold">1,234</span></p>
                            <p class="mb-2">PDFs：<span class="font-semibold">450</span></p>
                            <p class="mb-2">DOCX：<span class="font-semibold">320</span></p>
                            <p class="mb-2">XLSX：<span class="font-semibold">280</span></p>
                        </div>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            完整报告 →
                        </button>
                    `;
                break;
            case '最近文件':
                contentHtml = `
                        <ul class="text-sm text-gray-700 space-y-2 flex-grow">
                            <li class="hover:text-indigo-600 cursor-pointer">项目启动会议纪要.docx</li>
                            <li class="hover:text-indigo-600 cursor-pointer">Q2 财务数据分析.xlsx</li>
                            <li class="hover:text-indigo-600 cursor-pointer">营销素材库.zip</li>
                        </ul>
                        <button class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium text-sm text-left">
                            查看所有 →
                        </button>
                    `;
                break;
            case '自定义 HTML 应用':
                contentHtml = `
                        <div class="flex-grow overflow-auto border border-gray-300 rounded-lg p-2 text-sm"
                             style="height: 100px;"
                        >
                            ${widget.customHtml || '<p class="text-gray-500">在此处显示您的自定义 HTML 内容。</p>'}
                        </div>
                        <p class="text-xs text-red-500 mt-2">（此为自定义 HTML 片段，请注意安全风险）</p>
                    `;
                break;
            case 'AI 文档助手':
                // Note: aiInputText and aiResponse are global states, not per-widget.
                // This means all AI widgets will share the same input/output.
                // For truly independent AI widgets, each widget would need its own state.
                // For simplicity in HTML/JS, we keep it global.
                const summarizeBtnClasses = `flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-full font-semibold shadow-md transition duration-300 ${aiLoading || !aiInputText.trim() ? 'bg-purple-300 text-white cursor-not-allowed' : 'bg-purple-600 text-white hover:bg-purple-700'}`;
                const extractBtnClasses = `flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-full font-semibold shadow-md transition duration-300 ${aiLoading || !aiInputText.trim() ? 'bg-purple-300 text-white cursor-not-allowed' : 'bg-purple-600 text-white hover:bg-purple-700'}`;
                const loadingSpinner = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

                contentHtml = `
                        <textarea
                            id="aiInputTextarea"
                            class="w-full h-32 p-2 border border-gray-300 rounded-lg text-sm resize-y focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4"
                            placeholder="粘贴您的文档内容或会议纪要，让 AI 为您总结或提取行动项..."
                        >${aiInputText}</textarea>
                        <div class="flex space-x-2 mb-4">
                            <button id="aiSummarizeBtn" class="${summarizeBtnClasses}">
                                ${aiLoading ? loadingSpinner : ''}
                                <span>✨ 总结文档</span>
                            </button>
                            <button id="aiExtractActionItemsBtn" class="${extractBtnClasses}">
                                ${aiLoading ? loadingSpinner : ''}
                                <span>✨ 提取行动项</span>
                            </button>
                        </div>
                        ${aiResponse ? `
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm text-gray-800 max-h-40 overflow-y-auto">
                                <p class="font-semibold mb-1">AI 响应:</p>
                                <p class="whitespace-pre-wrap">${aiResponse}</p>
                            </div>
                        ` : ''}
                    `;
                break;
            default:
                return '';
        }

        return `
                <div class="${cardClasses}">
                    ${removeButtonHtml}
                    ${cardHeaderHtml}
                    ${contentHtml}
                </div>
            `;
    }

    // Function to add a widget
    function addWidget(widgetType, content = '', title = '') {
        const widgetId = (widgetType.id === 'custom-html-app' || widgetType.id === 'ai-doc-assistant')
            ? `${widgetType.id}-${Date.now()}`
            : widgetType.id;

        if (widgetType.id !== 'custom-html-app' && widgetType.id !== 'ai-doc-assistant' && activeWidgets.some(w => w.id === widgetId)) {
            return; // Prevent adding existing static widgets
        }

        activeWidgets.push({ id: widgetId, type: widgetType.name, customHtml: content, title: title || widgetType.name });
        hideModal();
        renderActiveWidgets(); // Re-render all widgets
        resetModalState();
    }

    // Function to remove a widget
    function removeWidget(widgetId) {
        activeWidgets = activeWidgets.filter(widget => widget.id !== widgetId);
        renderActiveWidgets(); // Re-render all widgets
    }

    // Function to show the add widget modal
    function showModal() {
        showAddWidgetModal = true;
        addWidgetModal.classList.remove('hidden');
        renderWidgetTypeSelection(); // Render type selection buttons
        updateAddButtonState(); // Update add button state initially
    }

    // Function to hide the add widget modal
    function hideModal() {
        showAddWidgetModal = false;
        addWidgetModal.classList.add('hidden');
        resetModalState();
    }

    // Reset modal specific states
    function resetModalState() {
        selectedWidgetTypeForAdd = null;
        customHtmlFileContent = '';
        customHtmlFileName = '';
        aiInputText = '';
        aiResponse = '';
        aiLoading = false;
        customHtmlFile.value = ''; // Clear file input
        customHtmlInputSection.classList.add('hidden');
        customHtmlFileNameDisplay.classList.add('hidden');
        customHtmlFilePrompt.classList.remove('hidden');
        updateAddButtonState();
    }

    // Render widget type selection buttons in the modal
    function renderWidgetTypeSelection() {
        widgetTypeSelection.innerHTML = '';
        availableWidgetTypes.forEach(widgetType => {
            const isAlreadyActive = (widgetType.id !== 'custom-html-app' && widgetType.id !== 'ai-doc-assistant') &&
                activeWidgets.some(w => w.id === widgetType.id);
            const isSelected = selectedWidgetTypeForAdd && selectedWidgetTypeForAdd.id === widgetType.id;

            const buttonClasses = `flex items-center space-x-4 p-4 rounded-xl border-2 ${
                isAlreadyActive
                    ? 'border-gray-300 bg-gray-100 text-gray-400 cursor-not-allowed'
                    : 'border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100'
            } transition duration-300 ${isSelected ? 'ring-2 ring-indigo-500' : ''}`;

            const textClasses = `text-lg font-medium ${isAlreadyActive ? 'line-through' : ''}`;
            const opacityClasses = `${isAlreadyActive ? 'opacity-50' : ''}`;

            const buttonHtml = `
                    <button type="button" data-widget-id="${widgetType.id}" class="${buttonClasses}">
                        <span class="${widgetType.color} ${opacityClasses}">
                            ${widgetType.icon}
                        </span>
                        <span class="${textClasses}">${widgetType.name}</span>
                    </button>
                `;
            widgetTypeSelection.insertAdjacentHTML('beforeend', buttonHtml);
        });

        // Attach click listeners to these newly rendered buttons
        widgetTypeSelection.querySelectorAll('button').forEach(button => {
            button.onclick = (event) => {
                const widgetId = event.currentTarget.dataset.widgetId;
                const type = availableWidgetTypes.find(t => t.id === widgetId);
                selectedWidgetTypeForAdd = type; // Direct assignment
                // Reset custom HTML/AI input states when a new type is selected
                customHtmlFileContent = '';
                customHtmlFileName = '';
                aiInputText = '';
                aiResponse = '';
                aiLoading = false;
                customHtmlFile.value = ''; // Clear file input
                updateModalContent();
                updateAddButtonState();
            };
        });
    }

    // Update modal content based on selected widget type
    function updateModalContent() {
        if (selectedWidgetTypeForAdd && selectedWidgetTypeForAdd.id === 'custom-html-app') {
            customHtmlInputSection.classList.remove('hidden');
            if (customHtmlFileName) {
                customHtmlFileNameDisplay.classList.remove('hidden');
                customHtmlFileNameSpan.textContent = customHtmlFileName;
                customHtmlFilePrompt.classList.add('hidden');
            } else {
                customHtmlFileNameDisplay.classList.add('hidden');
                customHtmlFilePrompt.classList.remove('hidden');
            }
        } else {
            customHtmlInputSection.classList.add('hidden');
        }
    }

    // Update the state of the "Add" button in the modal
    function updateAddButtonState() {
        let isDisabled = true;
        if (selectedWidgetTypeForAdd) {
            if (selectedWidgetTypeForAdd.id === 'custom-html-app') {
                isDisabled = !customHtmlFileContent; // Enabled only if file content exists
            } else if (selectedWidgetTypeForAdd.id === 'ai-doc-assistant') {
                isDisabled = false; // AI assistant can be added without initial content
            } else {
                // Check if static widget is already active
                isDisabled = activeWidgets.some(w => w.id === selectedWidgetTypeForAdd.id);
            }
        }

        if (isDisabled) {
            confirmAddWidgetBtn.classList.add('bg-indigo-300', 'text-white', 'cursor-not-allowed');
            confirmAddWidgetBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            confirmAddWidgetBtn.disabled = true;
        } else {
            confirmAddWidgetBtn.classList.remove('bg-indigo-300', 'text-white', 'cursor-not-allowed');
            confirmAddWidgetBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            confirmAddWidgetBtn.disabled = false;
        }
    }

    // --- Gemini API Integration for AI Document Assistant ---
    // Function to call Gemini API
    async function callGeminiApi(promptText) {
        aiLoading = true;
        aiResponse = ''; // Clear previous response
        renderActiveWidgets(); // Re-render to show loading state

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: promptText }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                aiResponse = text;
            } else {
                aiResponse = "抱歉，未能生成响应。请稍后再试。";
                console.error("Gemini API returned an unexpected structure:", result);
            }
        } catch (error) {
            aiResponse = "API 调用失败。请检查网络连接或稍后再试。";
            console.error("Error calling Gemini API:", error);
        } finally {
            aiLoading = false;
            renderActiveWidgets(); // Re-render to show response or error
        }
    }

    // Summarize Document function using Gemini API
    function summarizeDocument() {
        const currentAiInputTextarea = document.getElementById('aiInputTextarea');
        if (currentAiInputTextarea) {
            aiInputText = currentAiInputTextarea.value; // Get latest input from textarea
        }

        if (!aiInputText.trim()) {
            aiResponse = "请输入一些文本进行总结。";
            renderActiveWidgets();
            return;
        }
        const prompt = `请总结以下文档内容：\n\n${aiInputText}`;
        callGeminiApi(prompt);
    }

    // Extract Action Items function using Gemini API
    function extractActionItems() {
        const currentAiInputTextarea = document.getElementById('aiInputTextarea');
        if (currentAiInputTextarea) {
            aiInputText = currentAiInputTextarea.value; // Get latest input from textarea
        }

        if (!aiInputText.trim()) {
            aiResponse = "请输入一些文本以提取行动项。";
            renderActiveWidgets();
            return;
        }
        const prompt = `请从以下文本中提取所有行动项，并以列表形式返回：\n\n${aiInputText}`;
        callGeminiApi(prompt);
    }

    // Function to update AI widget buttons state (used when aiInputText changes)
    function updateAiWidgetButtons() {
        const summarizeBtn = document.getElementById('aiSummarizeBtn');
        const extractBtn = document.getElementById('aiExtractActionItemsBtn');
        const isDisabled = aiLoading || !aiInputText.trim();

        if (summarizeBtn) {
            if (isDisabled) {
                summarizeBtn.classList.add('bg-purple-300', 'text-white', 'cursor-not-allowed');
                summarizeBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                summarizeBtn.disabled = true;
                summarizeBtn.innerHTML = `${aiLoading ? `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>` : ''} <span>✨ 总结文档</span>`;
            } else {
                summarizeBtn.classList.remove('bg-purple-300', 'text-white', 'cursor-not-allowed');
                summarizeBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
                summarizeBtn.disabled = false;
                summarizeBtn.innerHTML = `<span>✨ 总结文档</span>`;
            }
        }
        if (extractBtn) {
            if (isDisabled) {
                extractBtn.classList.add('bg-purple-300', 'text-white', 'cursor-not-allowed');
                extractBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                extractBtn.disabled = true;
                extractBtn.innerHTML = `${aiLoading ? `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>` : ''} <span>✨ 提取行动项</span>`;
            } else {
                extractBtn.classList.remove('bg-purple-300', 'text-white', 'cursor-not-allowed');
                extractBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
                extractBtn.disabled = false;
                extractBtn.innerHTML = `<span>✨ 提取行动项</span>`;
            }
        }
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        renderActiveWidgets(); // Initial render of widgets

        addWidgetBtn.onclick = showModal;
        closeModalBtn.onclick = hideModal;
        cancelAddWidgetBtn.onclick = hideModal;

        confirmAddWidgetBtn.onclick = () => {
            if (selectedWidgetTypeForAdd) {
                if (selectedWidgetTypeForAdd.id === 'custom-html-app') {
                    addWidget(selectedWidgetTypeForAdd, customHtmlFileContent, customHtmlFileName);
                } else if (selectedWidgetTypeForAdd.id === 'ai-doc-assistant') {
                    addWidget(selectedWidgetTypeForAdd);
                } else {
                    addWidget(selectedWidgetTypeForAdd);
                }
            }
        };

        customHtmlFile.onchange = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    customHtmlFileContent = e.target.result;
                    customHtmlFileName = file.name;
                    customHtmlFileNameDisplay.classList.remove('hidden');
                    customHtmlFileNameSpan.textContent = customHtmlFileName;
                    customHtmlFilePrompt.classList.add('hidden');
                    updateAddButtonState();
                };
                reader.readAsText(file);
            } else {
                customHtmlFileContent = '';
                customHtmlFileName = '';
                customHtmlFileNameDisplay.classList.add('hidden');
                customHtmlFilePrompt.classList.remove('hidden');
                updateAddButtonState();
            }
        };
    });
</script>
</body>
</html>
